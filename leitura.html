<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leitura — Livraria do Ke</title>
  <meta name="description" content="Ambiente de leitura com conforto visual.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700;900&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .pdf-frame{
      width:100%; height:82vh;
      border:1px solid #e6e8ef; border-radius:12px; background:#fff;
      box-shadow:0 10px 26px rgba(13,42,74,.08);
    }
    .reader-header{ display:flex; align-items:center; gap:.75rem; flex-wrap:wrap }
    .reader-header h2{ margin:0 }
    .reader-meta{ color:var(--muted) }
    .reader-actions{ display:flex; gap:.5rem; flex-wrap:wrap }

    body.is-focus .header, body.is-focus .footer { display:none }
    body.is-focus .pdf-frame{ height: calc(100vh - 48px) }

    .reader-shell.is-wide .reader-body{ max-width:none }
    .reader-shell.is-wide .pdf-frame{ height: 88vh }
  </style>
</head>
<body>

<header class="header">
  <nav class="nav container" aria-label="Principal">
    <a class="brand" href="Pag01.html">
      <img src="assets/img/logo-livraria.png" alt="Logo Livraria do Ke">
      <span>Livraria do Ke</span>
    </a>
    <button class="burger" id="burger" aria-label="Abrir menu">☰</button>
    <div class="nav-links">
      <a href="Pag01.html">Início</a>
      <a href="Catalogo.html">Catálogo</a>
      <a href="sobre.html">Sobre</a>
      <a href="index.html" id="link-entrar">Entrar</a> <!-- será oculto se logado -->
    </div>
    <!-- NOVO: área para nome do usuário / explorar / sair -->
    <div class="nav-cta" id="user-area">
      <a class="btn btn-outline" href="Catalogo.html">Explorar</a>
    </div>
  </nav>
</header>

<main class="section">
  <div class="container">
    <div class="reader-shell" id="reader-shell">
      <div class="reader-top">
        <div class="reader-header">
          <a class="btn" href="Catalogo.html">← Voltar</a>
          <h2 id="book-title">Carregando…</h2>
          <span id="book-meta" class="reader-meta">—</span>
        </div>
        <div class="reader-actions">
          <button class="btn" id="focus-toggle" title="Modo foco (F)">Modo foco</button>
          <button class="btn" id="wide-toggle" title="Largura cheia (W)">Largura cheia</button>
          <div class="ctrl" style="display:inline-flex; gap:.25rem">
            <button class="btn" id="theme-light"  title="Claro">Claro</button>
            <button class="btn" id="theme-dark"   title="Escuro">Escuro</button>
            <button class="btn" id="theme-sepia"  title="Sépia">Sépia</button>
          </div>
          <a class="btn btn-outline" id="download-link" href="#" download>Baixar PDF</a>
          <a class="btn" id="newtab-link" href="#" target="_blank" rel="noopener">Abrir em nova aba</a>
        </div>
      </div>

      <div class="reader-body" style="grid-template-columns: 1fr; max-width: 1120px; margin: 0 auto;">
        <section class="reader-main">
          <div style="margin-top:.75rem">
            <iframe id="pdf" class="pdf-frame" title="Leitor de PDF"></iframe>
          </div>
        </section>
      </div>
    </div>
  </div>
</main>

<footer class="footer">
  <div class="container cols">
    <div>
      <a class="brand" href="Pag01.html">
        <img src="assets/img/logo-livraria.png" alt="Logo Livraria do Ke">
        <span>Livraria do Ke</span>
      </a>
      <p>Leitura que inspira. Atendimento humanizado e entrega para todo o Brasil.</p>
      <small>© 2025 Livraria do Ke. Todos os direitos reservados.</small>
    </div>
    <div>
      <strong>Links</strong><br>
      <a href="Catalogo.html">Catálogo</a><br>
      <a href="sobre.html">Sobre</a><br>
      <a href="index.html">Entrar</a>
    </div>
    <div>
  <strong>Contato</strong>
  <ul class="contact-list">
    <li class="contact">
      <img src="assets/img/icone_gmail.png" alt="" aria-hidden="true">
      <span>contato@livrariadoke.com</span>
    </li>
    <li class="contact">
      <img src="assets/img/icone_whats.png" alt="" aria-hidden="true">
      <span>(00) 00000-0000</span>
    </li>
  </ul>
</div>
  </div>
</footer>

<script type="module">
  import { BOOKS } from './js/books.js';

  /* === NOME DO USUÁRIO NO TOPO === */
  const userArea   = document.getElementById('user-area');
  const linkEntrar = document.getElementById('link-entrar');
  const current    = JSON.parse(localStorage.getItem('ldk_current_user') || 'null');

  if (current && (current.name || current.email)) {
    if (linkEntrar) linkEntrar.style.display = 'none';
    const firstName = (current.name || current.email).split(' ')[0];

    const hello = document.createElement('span');
    hello.className = 'chip';
    hello.textContent = `Olá, ${firstName}`;

    const explorar = document.createElement('a');
    explorar.className = 'btn';
    explorar.href = 'Catalogo.html';
    explorar.textContent = 'Explorar';

    const logout = document.createElement('button');
    logout.className = 'btn btn-outline';
    logout.type = 'button';
    logout.textContent = 'Sair';
    logout.addEventListener('click', () => {
      localStorage.removeItem('ldk_current_user');
      location.reload();
    });

    userArea.innerHTML = '';
    userArea.append(hello, explorar, logout);
  }
  /* === /NOME DO USUÁRIO === */

  // util: aceita 'senhora.pdf' OU 'assets/books/senhora.pdf'
  function normalizePath(file) {
    const hasDir = /[\\/]/.test(file);
    const base = hasDir ? file : `assets/books/${file}`;
    const parts = base.split('/');
    parts[parts.length - 1] = encodeURIComponent(parts[parts.length - 1]);
    return parts.join('/');
  }

  const burger = document.getElementById('burger');
  const links  = document.querySelector('.nav-links');
  burger?.addEventListener('click', () => links.classList.toggle('show'));

  const params = new URLSearchParams(location.search);
  const id = params.get('id');

  const titleEl = document.getElementById('book-title');
  const metaEl  = document.getElementById('book-meta');
  const frame   = document.getElementById('pdf');
  const dlLink  = document.getElementById('download-link');
  const tabLink = document.getElementById('newtab-link');
  const shell   = document.getElementById('reader-shell');

  const book = BOOKS.find(b => b.id === id);

  if (!book) {
    titleEl.textContent = 'Livro não encontrado';
    metaEl.textContent  = 'Verifique o link ou retorne ao catálogo.';
  } else {
    titleEl.textContent = book.title;
    metaEl.textContent  = `${book.author}${book.genres ? ' • ' + book.genres.join(' • ') : ''}`;

    const path = normalizePath(book.file);
    frame.src = `${path}#toolbar=0&navpanes=0&view=FitH`;
    dlLink.href  = path;
    dlLink.setAttribute('download', `${book.title}.pdf`);
    tabLink.href = path;

    document.title = `${book.title} — Leitura • Livraria do Ke`;
  }

  // Modo foco (F)
  const focusBtn = document.getElementById('focus-toggle');
  focusBtn.addEventListener('click', () => {
    document.body.classList.toggle('is-focus');
  });
  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'f') focusBtn.click();
  });

  // Largura cheia (W)
  const wideBtn = document.getElementById('wide-toggle');
  wideBtn.addEventListener('click', () => {
    shell.classList.toggle('is-wide');
  });
  document.addEventListener('keydown', (e) => {
    if (e.key.toLowerCase() === 'w') wideBtn.click();
  });

  // Temas do leitor (persistidos)
  const themeBtns = {
    light: document.getElementById('theme-light'),
    dark:  document.getElementById('theme-dark'),
    sepia: document.getElementById('theme-sepia'),
  };

  function applyTheme(name){
    shell.classList.remove('theme-dark','theme-sepia','theme-night');
    if (name === 'dark')  shell.classList.add('theme-dark');
    if (name === 'sepia') shell.classList.add('theme-sepia');
    localStorage.setItem('readerTheme', name);
  }

  themeBtns.light.addEventListener('click', () => applyTheme('light'));
  themeBtns.dark .addEventListener('click', () => applyTheme('dark'));
  themeBtns.sepia.addEventListener('click', () => applyTheme('sepia'));

  // restaura tema salvo
  applyTheme(localStorage.getItem('readerTheme') || 'light');
</script>
</body>
</html>
